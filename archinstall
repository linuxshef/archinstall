#!/bin/bash
#
#  Arch Linux Install (Archinstall) v.3.0.1
#------------------------------------------|
#           :
# Author    : LinuxShef
#           :
# Project   : https://github.com/shefpower/archinstall.git
#           :
# License   : LGPL-3.0 (http://opensource.org/licenses/lgpl-3.0.html)
#           :
#----------------------------------------------------------------------|
clear
echo '











                                      <──────────────────────────────────────────────────────────────────────────────>




                                     █████╗ ██████╗  ██████╗██╗  ██╗██╗███╗   ██╗███████╗████████╗ █████╗ ██╗     ██╗
                                    ██╔══██╗██╔══██╗██╔════╝██║  ██║██║████╗  ██║██╔════╝╚══██╔══╝██╔══██╗██║     ██║
                                    ███████║██████╔╝██║     ███████║██║██╔██╗ ██║███████╗   ██║   ███████║██║     ██║
                                    ██╔══██║██╔══██╗██║     ██╔══██║██║██║╚██╗██║╚════██║   ██║   ██╔══██║██║     ██║
                                    ██║  ██║██║  ██║╚██████╗██║  ██║██║██║ ╚████║███████║   ██║   ██║  ██║███████╗███████╗
                                    ╚═╝  ╚═╝╚═╝  ╚═╝ ╚═════╝╚═╝  ╚═╝╚═╝╚═╝  ╚═══╝╚══════╝   ╚═╝   ╚═╝  ╚═╝╚══════╝╚══════╝


                                                                     Power by LinuxShef


                                       <──────────────────────────────────────────────────────────────────────────────>


'
sleep 3
clear
echo '









                                                                      ArchInstall v.3.0

                                          <─────────────────────────────────────────────────────────────────────────>


                                                 ██╗      ██████╗  █████╗ ██████╗ ██╗███╗   ██╗ ██████╗
                                                 ██║     ██╔═══██╗██╔══██╗██╔══██╗██║████╗  ██║██╔════╝
                                                 ██║     ██║   ██║███████║██║  ██║██║██╔██╗ ██║██║  ███╗
                                                 ██║     ██║   ██║██╔══██║██║  ██║██║██║╚██╗██║██║   ██║
                                                 ███████╗╚██████╔╝██║  ██║██████╔╝██║██║ ╚████║╚██████╔╝██╗██╗██╗
                                                 ╚══════╝ ╚═════╝ ╚═╝  ╚═╝╚═════╝ ╚═╝╚═╝  ╚═══╝ ╚═════╝ ╚═╝╚═╝╚═╝


                                            <─────────────────────────────────────────────────────────────────────────>
'
sed -i s/'#en_US.UTF-8'/'en_US.UTF-8'/g /etc/locale.gen
sed -i s/'#ru_RU.UTF-8'/'ru_RU.UTF-8'/g /etc/locale.gen
echo 'LANG=ru_RU.UTF-8' > /etc/locale.conf
echo 'KEYMAP=ru' > /etc/vconsole.conf
echo 'FONT=cyr-sun16' >> /etc/vconsole.conf
setfont cyr-sun16
locale-gen >/dev/null 2>&1; RETVAL=$?
systemctl restart dhcpcd
dhcpcd
clear
echo '












                                              ─▄▀─▄▀
                                              ──▀──▀
                                              █▀▀▀▀▀█▄
                                              █░░░░░█─█     Добро пожаловать в программу установки ArchLinux !
                                              ▀▄▄▄▄▄▀▀
                                                ─────────────────────────────────────────────────────────────────


                                                    Внимание !  скрипт НЕ создает разделы на диске , разделы вы

                                                создаёте сами , поэтому если вы еще не создали разделы - создайте их


                                              ───────────────────────────────────────────────────────────────────────────

'
    echo -e "
      \t                                                          -> Пропустить введите     1    "

    echo -e "

      \t                                                          -> Разметить диск введите   2     "

    echo -n "

                                                                   -> Введите значение : "

      read main_menu
      case "$main_menu" in
         "1" ) clear
           ;;
         "2" ) clear ; echo '

















                                                             Добро пожаловать в меню раметки диска !

                                                . ────────────────────────────────────────────────────────────.
                                                .                                                             .
                                                .                                                             .
                                                .         Сейчас будет выведена информация о дисках           .
                                                .                                                             .
                                                .          Выберите тот диск который надо разметить           .
                                                .                                                             .
                                                .                                                             .
                                                .    ** Имя диска например ( sda , sdb, sdc , nvme0n1 ) **    .
                                                .                                                             .
                                                .                                                             .
                                                . ────────────────────────────────────────────────────────────.
'
sleep 2
read -t 99999 -n 1 -s -r -p "
                                                            -> Нажмите Enter для продолжения <- "
clear
fdisk -l

sleep 2
read -t 99999 -n 1 -s -r -p "
                                                            -> Нажмите Enter для продолжения <- "
clear
echo '

















                                               .─────────────────────────────────────────────────────────────.
                                               .                                                             .
                                               .                                                             .
                                               .             Введите имя диска для разметки                  .
                                               .                                                             .
                                               .                                                             .
                                               ──────────────────────────────────────────────────────────────
'
read -p "
                                                              -> Введите значение : " namedisk
cfdisk --zero /dev/$namedisk
      esac
clear
echo '








                                                                 Настройка часового пояса

                                              .──────────────────────────────────────────────────────────────.
                                              .                                                              .
                                              .                                                              .
                                              .  Настройка региона выставляет часовой пояс и время согласно  .
                                              .                                                              .
                                              .                      указаному региону                       .
                                              .                                                              .
                                              .  Название региона можно посмотреть в списке регионов или     .
                                              .                                                              .
                                              .  ввести вручную , если уже знаете , именно в таком формате   .
                                              .                                                              .
                                              .                  Пример -->   /Europe/Moscow                 .
                                              .                                                              .
                                              .                                                              .
                                              .──────────────────────────────────────────────────────────────.
'
read -p "
                                                          -> Введите значение : " region

clear
echo '











                                                                    Выбор диска для GRUB

                                              .─────────────────────────────────────────────────────────────.
                                              .                                                             .
                                              .                                                             .
                                              .  ** Это важно для дальнейщей установки загрузчика GRUB  **  .
                                              .                                                             .
                                              .                                                             .
                                              .         Сейчас будет выведена информация о дисках           .
                                              .                                                             .
                                              .   Выберите тот диск на который будет установлена система    .
                                              .                                                             .
                                              .            Например ( sda , sdb, sdc , nvme0n1 )            .
                                              .                                                             .
                                              .                                                             .
                                              . ────────────────────────────────────────────────────────────.
'
sleep 2
read -t 99999 -n 1 -s -r -p "
                                                           -> Нажмите Enter для продолжения <- "
clear
fdisk -l

sleep 2
read -t 99999 -n 1 -s -r -p "
                                                           -> Нажмите Enter для продолжения <- "

clear
echo '












                                                                    Выбор диска для GRUB

                                              .─────────────────────────────────────────────────────────────.
                                              .                                                             .
                                              .                                                             .
                                              .             Введите имя диска для разметки                  .
                                              .                                                             .
                                              .   ** Это важно для дальнейщей установки загрузчика GRUB **  .
                                              .                                                             .
                                              .         Например ( sda , sdb, sdc , nvme0n1 )               .
                                              .                                                             .
                                              .                                                             .
                                               ──────────────────────────────────────────────────────────────
'
read -p "
                                                               -> Введите значение : " disk
clear
echo '












                                                                  Ваш диск SSD или HDD

                                              .─────────────────────────────────────────────────────────────.
                                              .                                                             .
                                              .                                                             .
                                              .           Выберите свой вариант какой у вас диск            .
                                              .                                                             .
                                              .                                                             .
                                               ──────────────────────────────────────────────────────────────
'
  echo -e "

      \t                                                -> SSD - Nvme - m2 - usb_flash  (   1   )  "

    echo -e "

      \t                                                    ->       HDD        (   2   )  "

    echo -n "

                                                           -> Введите значение : "

      read main_menu
      case "$main_menu" in
         "1" ) clear ;
         sub='rw,noatime,compress=zstd:2,ssd,space_cache=v2,discard=async,subvol'
           ;;
         "2" ) clear ;
         sub='rw,relatime,space_cache=v2,autodefrag,nodatacow,subvol'
      esac

clear
echo '










                                                                        Выбор разделов

                                                .────────────────────────────────────────────────────────────.
                                                .                                                            .
                                                .                                                            .
                                                .             Введите одно из значений  1 или  2             .
                                                .                                                            .
                                                .           Для перехода к монтированию раздов диска         .
                                                .                                                            .
                                                .                                                            .
                                                .────────────────────────────────────────────────────────────.
'
    echo -e "

      \t                                                -> Смонтировать разделы введите    1   "

    echo -e "

      \t                                               -> Показать подсказку о разделах введите   2   "

    echo -n "

                                                           -> Введите значение : "

      read main_menu
      case "$main_menu" in
         "1" ) clear
           ;;
         "2" ) clear ;
fdisk -l
sleep 2
read -t 99999 -n 1 -s -r -p "
                                                          -> Нажмите Enter для продолжения <- "
      esac

echo '










                                                                        Выбор разделов

                                     .────────────────────────────────────────────────────────────────────────────────.
                                     .                                                                                .
                                     .                             Введите разделы диска                              .
                                     .                                                                                .
                                     .             (Root- Корневой)  (Boot- Загрузочный) (Swap- Подкачка)             .
                                     .                                                                                .
                                     .                                                                                .
                                     .                  Например ( sda2, sdb2, sdc2 , nvme0n1p2 )                     .
                                     .                                                                                .
                                     .                                                                                .
                                     .   ** Внимание ! Если вы не создали swap или home то оставьте поле пустым **    .
                                     .                                                                                .
                                     .!!! Для обычного Bios, и установки в один раздел оставьте поле boot пустым !!!! .
                                     .                                                                                .
                                     .────────────────────────────────────────────────────────────────────────────────.

'
read -p "
                                                                  -> Boot: " boot
read -p "
                                                                  -> Root: " root
read -p "
                                                                  -> Swap: " swap
read -p "
                                                                  -> Home: " home

clear

echo '












                                                              Выбор файловой системы Boot раздела

                                                .─────────────────────────────────────────────────────────────.
                                                .                                                             .
                                                .                                                             .
                                                .      Выберите файловую систему загрузочного  boot раздела   .
                                                .                                                             .
                                                .  Согласно вашей версии Bios (обычный стрый BIOS или UEFI)   .
                                                .                                                             .
                                                .   Для UEFI формат FAT32 . Для обычнго BIOS Ext4 или Ext2    .
                                                .                                                             .
                                                .                                                             .
                                                .─────────────────────────────────────────────────────────────.
'
echo -e "\t
                                                     -> Для UEFI введите     (  1  )  "
echo -e "\t

                                                     -> Не форматировать  введите     (  2  )

                                                      ( Для утсановки в один раздел DOS/MBR или рядом с Windows )"
echo -e "\t


                                                     -> Для обычного Bios форматировать в Ext4 введите   (  3  ) "
echo -e "\t

                                                     -> Для обычного Bios фоматировать в Ext2 введиет    (  4  ) "
echo -n "


                                                         -> Введите значение : "
read main_menu
      case "$main_menu" in
         "1" ) clear ; mkfs.vfat -F32 /dev/$boot
         ;;
         "3" ) clear ; mkfs.ext4 /dev/$boot
         ;;
         "4" ) clear ; mkfs.ext2 /dev/$boot
         ;;
         "2" ) clear
      esac

clear

echo '












                                                              Выбор файловой системы корневого раздела

                                                      .───────────────────────────────────────────────────────.
                                                      .                                                       .
                                                      .                                                       .
                                                      .   Выберите файловую систему корневого Root раздела    .
                                                      .                                                       .
                                                      .                      Btrfs или Ext4                   .
                                                      .                                                       .
                                                      .                                                       .
                                                      .───────────────────────────────────────────────────────.

                                                          -> Чтобы пропустить это шаг нажмите Enter <-
'
echo -e "\t

                                                           -> Форматировать в Btrfs введите    1    "
echo -e "\t


                                                           -> Форматировать в Ext4 введите    2    "
echo -n "

                                                              -> Введите значение : "
read main_menu
      case "$main_menu" in
         "1" ) clear ; mkfs.btrfs -f /dev/$root
         ;;
         "2" ) clear ; mkfs.ext4 /dev/$root
      esac

clear
mkswap /dev/$swap
swapon /dev/$swap

clear
echo '










                                                       Home раздел , выбор файловой системы Home раздела

                                                    .───────────────────────────────────────────────────────.
                                                    .                                                       .
                                                    .                                                       .
                                                    .       Выберите файловую систему Home раздела          .
                                                    .                                                       .
                                                    .                      Btrfs или Ext4                   .
                                                    .                                                       .
                                                    .                                                       .
                                                    .───────────────────────────────────────────────────────.

                                                         -> Чтобы пропустить это шаг нажмите Enter <-
'
echo -e "\t

                                                          -> Форматировать в Btrfs введите    1    "
echo -e "\t


                                                          -> Форматировать в Ext4 введите    2    "
echo -n "

                                                             -> Введите значение : "
read main_menu
      case "$main_menu" in
         "1" ) clear ; mkfs.btrfs -f /dev/$home
         ;;
         "2" ) clear ; mkfs.ext4 /dev/$home
      esac

clear

echo '









                                                                     Монтирование разделов

                                                    .───────────────────────────────────────────────────────.
                                                    .                                                       .
                                                    .                                                       .
                                                    .       Выберите один из вариантов монтирования         .
                                                    .                                                       .
                                                    .                                                       .
                                                    .───────────────────────────────────────────────────────.
'
echo -e "\t

                                                         ->    Btrfs  ( БЕЗ home ) введите  (  1  )   "
echo -e "\t


                                                         ->    Ext4   ( БЕЗ home ) введите   (  2  )   "
echo -e "\t


                                                          -> Смонтировать Home введите   (  3  )   "

echo -n "
                                                            -> Введите значение : "

read main_menu
      case "$main_menu" in
        "1") clear ;
mount  /dev/$root /mnt

btrfs su cr /mnt/@

btrfs su cr /mnt/@home

btrfs su cr /mnt/@var

btrfs su cr /mnt/@log

btrfs su cr /mnt/@pkg

btrfs su cr /mnt/@.snapshots

umount -R /mnt

mount -o ${sub}=@ /dev/$root /mnt

mkdir -p /mnt/{boot,home,var,var/log,var/cache/pacman/pkg,.snapshots}

mount -o ${sub}=@home /dev/$root /mnt/home

mount -o ${sub}=@var /dev/$root /mnt/var

mount -o ${sub}=@log /dev/$root /mnt/var/log

mount -o ${sub}=@pkg /dev/$root /mnt/var/cache/pacman/pkg

mount -o ${sub}=@.snapshots /dev/$root /mnt/.snapshots
         ;;
         "2" ) clear ;
mount  /dev/$root /mnt
mkdir /mnt/boot
        ;;
        "3" ) clear ; echo '









                                                             Монтирование  домашнего ( home ) раздела

                                                    .───────────────────────────────────────────────────────.
                                                    .                                                       .
                                                    .                                                       .
                                                    .       Выберите один из вариантов монтирования         .
                                                    .                                                       .
                                                    .                                                       .
                                                    .───────────────────────────────────────────────────────.
'
echo -e "\t

                                                             -> Смонтировать Home в Btrfs    1    "
echo -e "\t


                                                             -> Смонтировать Home в Ext4     2    "


echo -n "
                                                                -> Введите значение : "

read main_menu
      case "$main_menu" in
         "1" ) clear ;
mount  /dev/$root /mnt

btrfs su cr /mnt/@

btrfs su cr /mnt/@home

btrfs su cr /mnt/@var

btrfs su cr /mnt/@log

btrfs su cr /mnt/@pkg

btrfs su cr /mnt/@.snapshots

umount -R /mnt

mount -o ${sub}=@ /dev/$root /mnt

mkdir -p /mnt/{boot,home,var,var/log,var/cache/pacman/pkg,.snapshots}

mount /dev/$home /mnt/home

mount -o ${sub}=@var /dev/$root /mnt/var

mount -o ${sub}=@log /dev/$root /mnt/var/log

mount -o ${sub}=@pkg /dev/$root /mnt/var/cache/pacman/pkg

mount -o ${sub}=@.snapshots /dev/$root /mnt/.snapshots
         ;;
         "2" ) clear ;
mount  /dev/$root /mnt
mkdir /mnt/home
mkdir /mnt/boot
mount /dev/$home /mnt/home
      esac

        esac

clear

echo '












                                                                   Монтирование boot раздела

                                                  .──────────────────────────────────────────────────────────.
                                                  .                                                          .
                                                  .                                                          .
                                                  .          Монтирование загрузочного раздела !             .
                                                  .                                                          .
                                                  .   Выберите один из варинтов монтирования boot раздела    .
                                                  .                                                          .
                                                  .       Для обычного биоса (НЕ UEFI) введите   2           .
                                                  .                                                          .
                                                  .             Для UEFI биоса , введите   1                 .
                                                  .                                                          .
                                                  .          Без boot раздела DOS/MBR введите     3          .
                                                  .                                                          .
                                                  .                                                          .
                                                  .──────────────────────────────────────────────────────────.
'
echo -e "\t
                                                             -> Для UEFI или EFI введите   (  1  )    "
echo -e "\t

                                                             -> Для обычного Bios введите  (  2  ) "

echo -e "\t
                                                             -> Без boot раздела DOS/MBR   (  3  )

                                                            (Если вы устанавливаете все в один радел для  MBR ) "
echo -n "

                                                               -> Введите значение : "
read main_menu
      case "$main_menu" in
         "1" )
         mkdir /mnt/boot/efi ; mount /dev/$boot /mnt/boot/efi
         Uefi="grub-install --target=x86_64-efi --efi-directory=/boot/efi --bootloader-id=ShefOS --no-nvram --removable /dev/$disk"
         ;;
         "2" )
         mount /dev/$boot  /mnt/boot/
         BIOS="grub-install /dev/$disk"
         ;;
         "3" )
         clear
         BBOOT="grub-install /dev/$disk"
      esac

clear
echo '














                                                                          Парль root

                                                 .───────────────────────────────────────────────────────────.
                                                 .                                                           .
                                                 .                                                           .
                                                 .                   Укажите парль Root !                    .
                                                 .                                                           .
                                                 .          Внимание ! Запомните логин рут , здесь - root    .
                                                 .                                                           .
                                                 .              И пароль тот который вы щас зададите         .
                                                 .                                                           .
                                                 .───────────────────────────────────────────────────────────.
'
read -p "
                                                           -> Введите пароль root :  " password
clear
echo '













                                                                  Учетная запись пользователя

                                                 .───────────────────────────────────────────────────────────.
                                                 .                                                           .
                                                 .                                                           .
                                                 .           Введите имя вашей учетной записи !!!            .
                                                 .                                                           .
                                                 .                                                           .
                                                 .───────────────────────────────────────────────────────────.
'
read -p "
                                                       -> Введите имя учетной записи :  " username
clear
echo '













                                                               Парль учетной записи пользователя

                                                 .───────────────────────────────────────────────────────────.
                                                 .                                                           .
                                                 .                                                           .
                                                 .           Укажите парль вашей учетной записи !!!          .
                                                 .                                                           .
                                                 .                                                           .
                                                 .───────────────────────────────────────────────────────────.
'
read -p "
                                                       -> Введите пароль пользователя :  " userpassword
clear

echo '









                                                                        Выбор ядра системы

                                                .──────────────────────────────────────────────────────────────.
                                                .                                                              .
                                                .                                                              .
                                                .  Выберите один из варинтов ядра ,для установки системы :     .
                                                .                                                              .
                                                .   -> С обычным ядром Linux - введите 1                       .
                                                .                                                              .
                                                .   -> C производительным ядром Linux-zen - введите 2          .
                                                .                                                              .
                                                .   -> С ядром повышеной стабильности Linux-lts - введите 3    .
                                                .                                                              .
                                                .                                                              .
                                                .──────────────────────────────────────────────────────────────.
'
echo -e "\t
                                                                     -> Linux ( 1 ) "
echo -e "\t

                                                                     -> Linux-zen ( 2 )"
echo -e "\t

                                                                     -> Linux-lts ( 3 )"
echo -n "

                                                                     -> Введите значение : "
read main_menu
      case "$main_menu" in

         "1" ) kernel='pacstrap -i /mnt base base-devel linux linux-headers linux-firmware dosfstools btrfs-progs intel-ucode amd-ucode iucode-tool archlinux-keyring bluez bluez-utils nano vim dhcpcd dhclient networkmanager --noconfirm'
         ;;
         "2" ) kernel='pacstrap -i /mnt base base-devel linux-zen linux-zen-headers linux-firmware dosfstools btrfs-progs intel-ucode amd-ucode iucode-tool archlinux-keyring bluez bluez-utils nano vim dhcpcd dhclient networkmanager --noconfirm'
         ;;
         "3" ) kernel='pacstrap -i /mnt base base-devel linux-lts linux-lts-headers linux-firmware dosfstools btrfs-progs intel-ucode amd-ucode iucode-tool archlinux-keyring bluez bluez-utils nano vim dhcpcd dhclient networkmanager --noconfirm'
      esac

clear

echo '










                              ____________________¶¶¶¶¶¶¶
                              ___________________¶¶
                              __________________¶¶
                              _________________¶¶
                              ________________¶¶              Добро пожаловать в меню установки рабочего стола
                              _______________¶¶
                              ____$$$$$$$$$$$$$$$$$$                      (графическая облочка)
                              _____$_______________$       ────────────────────────────────────────────────────>
                              ______$________ZZZZ$
                              _______$_____ZZZZZ$
                              ________$__ZZZZZZ$
                              _________$ZZZZZZ$                Здесь вы можете выбрать драйвера для своей видеокарты
                              __________$ZZZZ$
                              ___________$ZZ$
                              ____________$$                ────────────────────────────────────────────────────────>
                              ___________ $$$
                              __________$$$$$$
                              ________$$$$$$$$$$               И установить графическую оболочку ( рабочий стол )
                              _____$$$$$$$$$$$$$$

                           ────────────────────────────────────────────────────────────────────────────────────────────────────>
'
    echo -e "

      \t                                             -> Установить графическую оболочку введите     1     "


    echo -e "

      \t                                             -> НЕ устанавливать графическую оболочку введите     2     "


    echo -n "
                                                             -> Введите значение : "

      read main_menu
      case "$main_menu" in
         "1" ) clear ;
echo '






                                                                     Драйвера видеокарты

                                             .─────────────────────────────────────────────────────────────────.
                                             .                                                                 .
                                             .                                                                 .
                                             .     Добро пожаловать в меню установки графических драйверов     .
                                             .                                                                 .
                                             .  На этом этапе будут установлены драйверы для вашей видеокарты  .
                                             .                                                                 .
                                             .      Далее вы попадете в меню выбора графических оболочек!      .
                                             .                                                                 .
                                             .                                                                 .
                                             .─────────────────────────────────────────────────────────────────.

'
echo -e "\t
                                                           -> Для графики Intel введите ( 1 ) "
echo -e "\t


                                                           -> Для графики AMD введите   ( 2 )  "

echo -e "\t

                                                           -> Для графики NVIDIA введите ( 3 ) "

echo -e "\t

                                                           -> Ручная установка драйвера Nvidia ( 4 ) "

echo -e "\t

                                                          -> Для установки драйвера гибридной графики
                                                            Например INTEL + NVIDIA , AMD + NVIDIA и т.д  ( 5 ) "
echo -n "

                                                            -> Введите значение : "
read main_menu
      case "$main_menu" in
         "1" ) graphc_drivers='pacstrap -i /mnt mesa mesa-demos xf86-video-intel lib32-mesa vulkan-intel lib32-vulkan-intel vulkan-icd-loader lib32-vulkan-icd-loader network-manager-applet libva-intel-driver lib32-libva-intel-driver --noconfirm'
        ;;
         "2" ) graphc_drivers='pacstrap -i /mnt xf86-video-ati xf86-video-amdgpu mesa mesa-demos lib32-mesa vulkan-radeon lib32-vulkan-radeon vulkan-icd-loader lib32-vulkan-icd-loader amdvlk lib32-amdvlk network-manager-applet --noconfirm'
        ;;
         "3" )
clear
echo '












                                                    Добро пожаловать в меню установки драйвера NVIDIA

                                                 .───────────────────────────────────────────────────────.
                                                 .                                                       .
                                                 .       Здесь два варинта установки драйверов           .
                                                 .                                                       .
                                                 .   Open source драйвер  и проприетарный драйвер        .
                                                 .                                                       .
                                                 .   Опенсоурс драйвер лучше для видеокарт старых ,      .
                                                 .                                                       .
                                                 .  до архитектуры Kepler , а для новых видеокарт лучше  .
                                                 .                                                       .
                                                 .    проприетарный драйвер . Выберите свой варинт       .
                                                 .                                                       .
                                   <───────────────────────────────────────────────────────────────────────────────────>

                                       Установка драйвера не гарантирует что все с первого раза запуститься хорошо.

                                              Nvidia не открывает свой код для написания нормальных драйверов ,

                                        поэтому гарантировать что драйвер заведется после установки невозможно !!!

                                    <────────────────────────────────────────────────────────────────────────────────>
'
echo -e "\t


                                                      ->  Установить проприетарный драйвер     1     "
echo -e "\t


                                                       ->  Установить Open source драйвер      2    "
echo -n "

                                                          -> Введите значение : "
read main_menu
      case "$main_menu" in
       "1" )
       graphc_drivers='pacstrap -i /mnt vulkan-icd-loader lib32-vulkan-icd-loader nvidia-dkms nvidia-utils lib32-nvidia-utils vulkan-icd-loader lib32-vulkan-icd-loader lib32-opencl-nvidia opencl-nvidia network-manager-applet nvidia-settings --noconfirm'
       #nvidia_driver="mhwd -a pci nonfree 0300"
       ;;
       "2" ) graphc_drivers='pacstrap -i /mnt vulkan-icd-loader lib32-vulkan-icd-loader xf86-video-nouveau nvidia-utils lib32-nvidia-utils vulkan-icd-loader lib32-vulkan-icd-loader lib32-opencl-nvidia opencl-nvidia network-manager-applet nvidia-settings --noconfirm'
     esac
        ;;
        "4" ) clear
#clear
#echo '
#
#
#
#
#
#
#
#
#
#
#
#
#                                               Добро пожаловать в меню ручной установки драйверов NVIDIA
#
#                                          <─────────────────────────────────────────────────────────────────>
#
#                                           Здесь вам будет показан список доступных для установки драйверов Nvidia
#
#                                              Далее вам надо будет ввести назание этого драйвера для установки
#
#                                               Например драйвер  video-nvidia , и прописать в поле для ввода
#
#                                    <───────────────────────────────────────────────────────────────────────────────────>
#
#                                         Установка драйвера не гарантирует что все с первого раза запуститься хорошо.
#
#                                              Nvidia не открывает свой код для написания нормальных драйверов ,
#
#                                          поэтому гарантировать что драйвер заведется после установки невозможно !!!
#
#                                      <────────────────────────────────────────────────────────────────────────────────>
#'
#echo -e "\t
#
#                                                             ->   Продолжить    1     "
#
#echo -n "
#
#                                                             -> Введите значение : "
#read main_menu
#      case "$main_menu" in
#         "1" )
#         clear ; mhwd --list
#         read -p "
#                                                           -> Введите значение : " namedriver
#
#         hwddriver='mhwd --install pci $namedriver'
#      esac
#
        ;;
        "5" )
clear
echo '












                                            Добро пожаловать в меню установки драйверов для гибридной графики

                                  .─────────────────────────────────────────────────────────────────────────────────────.
                                  .                                                                                     .
                                  . Установка драйвера Nvidia не гарантирует ,что все с первого раза запуститься хорошо .
                                  .                                                                                     .
                                  .      Nvidia не открывает свой код для написания нормальных драйверов ,              .
                                  .                                                                                     .
                                  .    поэтому гарантировать что драйвер заведется после установки невозможно !!!       .
                                  .                                                                                     .
                                   ──────────────────────────────────────────────────────────────────────────────────────
'
echo -e "\t

                                                       ->  INTEL + AMD      1     "

echo -e "\t
                                                       ->  INTEL + NVIDIA ( Проприетарный драйвер  Nvidia )     2    "
echo -e "\t

                                                       ->  INTEL + NVIDIA ( Open source драйвер Nvidia )     3    "

echo -e "\t
                                                       ->  AMD + NVIDA   ( Проприетарный драйвер  Nvidia )    4    "

echo -e "\t
                                                       ->  AMD + NVIDA   ( Open source драйвер Nvidia )    5    "
echo -n "


                                                        -> Введите значение : "
read main_menu
      case "$main_menu" in
       "1" )
       graphc_drivers='pacstrap -i /mnt mesa mesa-demos xf86-video-intel lib32-mesa vulkan-intel lib32-vulkan-intel vulkan-icd-loader lib32-vulkan-icd-loader network-manager-applet libva-intel-driver lib32-libva-intel-driver xf86-video-ati xf86-video-amdgpu mesa mesa-demos lib32-mesa vulkan-radeon lib32-vulkan-radeon vulkan-icd-loader amdvlk lib32-amdvlk lib32-vulkan-icd-loader --noconfirm'
       ;;
       "2" )
       graphc_drivers='pacstrap -i /mnt xf86-video-intel vulkan-intel lib32-vulkan-intel vulkan-icd-loader lib32-vulkan-icd-loader network-manager-applet libva-intel-driver lib32-libva-intel-driver nvidia-dkms nvidia-settings nvidia-prime --noconfirm'
       #nvidia_driver="mhwd -a pci nonfree 0300"
       #optimus="systemctl enable optimus-manager"
       ;;
       "3" )
       graphc_drivers='pacstrap -i /mnt xf86-video-intel vulkan-intel lib32-vulkan-intel vulkan-icd-loader lib32-vulkan-icd-loader network-manager-applet libva-intel-driver lib32-libva-intel-driver xf86-video-nouveau nvidia-utils lib32-nvidia-utils vulkan-icd-loader lib32-vulkan-icd-loader lib32-opencl-nvidia opencl-nvidia nvidia-settings nvidia-prime --noconfirm'
       ;;
       "4" )
       graphc_drivers='pacstrap -i /mnt xf86-video-ati xf86-video-amdgpu vulkan-radeon lib32-vulkan-radeon vulkan-icd-loader lib32-vulkan-icd-loader network-manager-applet amdvlk lib32-amdvlk nvidia-dkms nvidia-settings nvidia-prime --noconfirm'
       #nvidia_driver="mhwd -a pci nonfree 0300"
       #optimus="systemctl enable optimus-manager"
       ;;
       "5" )
       graphc_drivers='pacstrap -i /mnt xf86-video-ati xf86-video-amdgpu  vulkan-radeon lib32-vulkan-radeon vulkan-icd-loader lib32-vulkan-icd-loader vulkan-icd-loader lib32-vulkan-icd-loader xf86-video-nouveau nvidia-utils lib32-nvidia-utils vulkan-icd-loader lib32-vulkan-icd-loader lib32-opencl-nvidia opencl-nvidia  amdvlk lib32-amdvlk network-manager-applet nvidia-settings nvidia-prime --noconfirm'
       #optimus="systemctl enable optimus-manager"
      esac

      esac
clear

echo '







                                                                       Графическая оболочка

                                                    .────────────────────────────────────────────────────────.
                                                    .                                                        .
                                                    .                                                        .
                                                    .            Теперь выберите один из вариантов           .
                                                    .                                                        .
                                                    .      Для установки нужной вам графической оболочки     .
                                                    .                                                        .
                                                    .                                                        .
                                                    .────────────────────────────────────────────────────────.
'
echo -e "\t
                                                            -> Для установки KDE введите ( 1 ) "
echo -e "\t

                                                            -> Для установки GNOME введите ( 2 ) "
echo -e "\t

                                                            -> Для установки XFCE введите ( 3 ) "
echo -e "\t

                                                             -> Для установки I3 введите ( 4 ) "
echo -e "\t

                                                             -> Для установки Lxqt введите ( 5 ) "
echo -e "\t

                                                          -> Для установки KDE облегченная введите ( 6 )

                                                                Без пакета    kde-applicatios          "
echo -e "\t

                                                          -> Для установки GNOME облегченная введите ( 7 )

                                                                Без пакета gnome-extra                   "
echo -e "\t

                                                            -> Для установки Cinnamon введите ( 8 ) "
echo -e "\t

                                                             -> Для установки MATE введите ( 9 ) "
echo -n "


                                                               -> Введите значение : "
read main_menu
      case "$main_menu" in
         "1" )
update='pacman -Syy'

desktop='pacstrap -i /mnt xorg xorg-server xorg-xwayland plasma cups kde-applications kmix discover cups sddm sddm-kcm firefox packagekit-qt5 bluez bluez-utils --noconfirm'

displaymanager='systemctl enable sddm --force'
        ;;
         "2" )
update='pacman -Syy'

desktop='pacstrap -i /mnt xorg xorg-server gnome cups gnome-extra firefox gdm --noconfirm'

displaymanager='systemctl enable gdm --force'
        ;;
         "3" )
update='pacman -Syy'

desktop='pacstrap -i /mnt xorg xorg-server xfce4 cups xfce4-goodies lightdm firefox cups lightdm-gtk-greeter pavucontrol gvfs gvfs-mtp thunar-volman network-manager-applet bluez bluez-utils pulseaudio --noconfirm'

displaymanager='systemctl enable lightdm --force'
        ;;
         "4" )
update='pacman -Syy'

desktop='pacstrap -i /mnt xorg xorg-server xorg-xinit cups xdg-utils xdg-user-dirs cups i3-gaps i3blocks i3status dmenu rofi xfce4-terminal firefox nitrogen picom network-manager-applet blueman bluez bluez-utils gvfs gvfs-mtp pcmanfm --noconfirm'
         ;;
         "5" )
update='pacman -Syy'

desktop='pacstrap -i /mnt xorg xorg-server xdg-user-dirs cups xdg-utils firefox cups pcmanfm lxqt breeze-icons sddm sddm-kcm bluez gvfs gvfs-mtp bluez-utils --noconfirm'

displaymanager='systemctl enable sddm --force'
          ;;
          "6" )
update='pacman -Syy'

desktop='pacstrap -i /mnt xorg xorg-server xorg-xwayland plasma cups konsole dolphin kmix discover cups sddm sddm-kcm firefox packagekit-qt5 bluez bluez-utils --noconfirm'

displaymanager='systemctl enable sddm --force'
          ;;
          "7")
update='pacman -Syy'

desktop='pacstrap -i /mnt xorg xorg-server gnome cups nautilus firefox gnome-terminal firefox gdm --noconfirm'

displaymanager='systemctl enable gdm --force'
         ;;
         "8" )
update='pacman -Syy'

desktop='pacstrap -i /mnt cinnamon gnome-terminal parcellite firefox gvfs gvfs-mtp pcmanfm lightdm lightdm-slick-greeter bluez-utils --noconfirm'

displaymanager='systemctl enable lightdm --force'

slick='arch-chroot'
          ;;
          "9" )
update='pacman -Syy'

desktop='pacstrap -i /mnt mate mate-extra dconf-editor lightdm lightdm-slick-greeter gvfs pcmanfm gvfs-mtp bluez bluez-utils --noconfirm'

displaymanager='systemctl enable lightdm --force'
      esac
           ;;
         "2" ) clear ;
      esac

#----------------------------------------------------------------------|
#                                                      #
#                         Pacman                       #
#                                                      #
#----------------------------------------------------------------------|
clear
sed -i "/\[multilib\]/,/Include/"'s/^#//' /etc/pacman.conf
sed -i s/'#ParallelDownloads = 5'/'ParallelDownloads = 5'/g /etc/pacman.conf
sed -i s/'#VerbosePkgLists'/'VerbosePkgLists'/g /etc/pacman.conf
sed -i s/'#Color'/'ILoveCandy'/g /etc/pacman.conf
echo '









───────────────────────────────────────────────────────────────|
──────────────────────
────────────────────── ██████╗  █████╗  ██████╗███╗   ███╗ █████╗ ███╗   ██╗
────────────────────── ██╔══██╗██╔══██╗██╔════╝████╗ ████║██╔══██╗████╗  ██║
──▒▒▒▒▒────▄████▄───── ██████╔╝███████║██║     ██╔████╔██║███████║██╔██╗ ██║
─▒─▄▒─▄▒──███▄█▀────── ██╔═══╝ ██╔══██║██║     ██║╚██╔╝██║██╔══██║██║╚██╗██║
─▒▒▒▒▒▒▒─▐████──█──█── ██║     ██║  ██║╚██████╗██║ ╚═╝ ██║██║  ██║██║ ╚████║
─▒▒▒▒▒▒▒──█████▄────── ╚═╝     ╚═╝  ╚═╝ ╚═════╝╚═╝     ╚═╝╚═╝  ╚═╝╚═╝  ╚═══╝
─▒─▒─▒─▒───▀████▀─────────────────────────────────────────────────────────────────|

                       Пожалуйста пдождите , идет настройка скачивания пакетов,

                                  это займет пару мнгновений ) .......

              ─────────────────────────────────────────────────────────────────────────────────────|
'
sleep 4
pacman -Syy reflector archlinux-keyring --noconfirm
reflector --sort rate -l 20 --save /etc/pacman.d/mirrorlist
pacman -Syy
#---------------PACSTRAP-----------------------------------------------
${kernel}
#------------------------------------------------------------------------
genfstab -U /mnt >> /mnt/etc/fstab
arch-chroot /mnt /bin/bash -c "ln -sf /usr/share/zoneinfo/$region /etc/localtime"
arch-chroot /mnt /bin/bash -c "hwclock --systohc"
arch-chroot /mnt /bin/bash -c "sed -i s/'#en_US.UTF-8'/'en_US.UTF-8'/g /etc/locale.gen"
arch-chroot /mnt /bin/bash -c "sed -i s/'#ru_RU.UTF-8'/'ru_RU.UTF-8'/g /etc/locale.gen"
arch-chroot /mnt /bin/bash -c "locale-gen"
arch-chroot /mnt /bin/bash -c "echo 'LANG=ru_RU.UTF-8' > /etc/locale.conf"
arch-chroot /mnt /bin/bash -c "echo 'KEYMAP=ru' > /etc/vconsole.conf"
arch-chroot /mnt /bin/bash -c "echo 'FONT=cyr-sun16' >> /etc/vconsole.conf"
arch-chroot /mnt /bin/bash -c "echo 'ARCH' > /etc/hostname"
arch-chroot /mnt /bin/bash -c "echo '127.0.0.1 localhost' > /etc/hosts"
arch-chroot /mnt /bin/bash -c "echo '::1       localhost' >> /etc/hosts"
arch-chroot /mnt /bin/bash -c "echo '127.0.0.1 ARCH.localdomain ARCH' >> /etc/hosts"
arch-chroot /mnt /bin/bash -c "sed -i s/'#ParallelDownloads = 5'/'ParallelDownloads = 6'/g /etc/pacman.conf"
arch-chroot /mnt /bin/bash -c "sed -i s/'#VerbosePkgLists'/'VerbosePkgLists'/g /etc/pacman.conf"
arch-chroot /mnt /bin/bash -c "sed -i s/'#Color'/'ILoveCandy'/g /etc/pacman.conf"
sed -i "/\[multilib\]/,/Include/"'s/^#//' /mnt/etc/pacman.conf
arch-chroot /mnt /bin/bash -c "sed -i s/'# %wheel ALL=(ALL:ALL) ALL'/'%wheel ALL=(ALL:ALL) ALL'/g /etc/sudoers"
echo "root:$password" | arch-chroot /mnt chpasswd
arch-chroot /mnt /bin/bash -c "mkinitcpio -P"
arch-chroot /mnt /bin/bash -c "pacman -Syy grub grub-btrfs efibootmgr --noconfirm"
arch-chroot /mnt /bin/bash -c "useradd -m -G wheel -s /bin/bash $username"
echo "$username:$userpassword" | arch-chroot /mnt chpasswd
arch-chroot /mnt /bin/bash -c "systemctl enable NetworkManager"
arch-chroot /mnt /bin/bash -c "${Uefi}"
arch-chroot /mnt /bin/bash -c "${BIOS}"
arch-chroot /mnt /bin/bash -c "${BBOOT}"
arch-chroot /mnt /bin/bash -c "grub-mkconfig -o /boot/grub/grub.cfg"
#---------------------------------------------------------------------
${graphc_drivers}
${update}
${desktop}
${slick} /mnt /bin/bash -c "sed -i s/'#greeter-session=lightdm-slick-greeter'/'greeter-session=lightdm-slick-greeter'/g  /etc/lightdm/lightdm.conf" >/dev/null 2>&1; RETVAL=$?
arch-chroot /mnt /bin/bash -c "${displaymanager}"
arch-chroot /mnt /bin/bash -c "grub-mkconfig -o /boot/grub/grub.cfg"
arch-chroot /mnt /bin/bash -c "systemctl enable NetworkManager"
arch-chroot /mnt /bin/bash -c "systemctl enable bluetooth"
arch-chroot /mnt /bin/bash -c "systemctl enable cups"
arch-chroot /mnt /bin/bash -c "mkinitcpio -P"
arch-chroot /mnt /bin/bash -c "grub-mkconfig -o /boot/grub/grub.cfg"
#------------------------------------------------------------------------
#
#                     UMOUNT & REBOOT
#
#-------------------------------------------------------------------------
clear
echo '













───────────────────────────────────────────────────────────────────>
░░░░░░░░░░░░▄▄░░░░░░░░░
░░░░░░░░░░░█░░█░░░░░░░░
░░░░░░░░░░░█░░█░░░░░░░░
░░░░░░░░░░█░░░█░░░░░░░░
░░░░░░░░░█░░░░█░░░░░░░░
███████▄▄█░░░░░██████▄░░
▓▓▓▓▓▓█░░░░░░░░░░░░░░█░
▓▓▓▓▓▓█░░░░░░░░░░░░░░█░              Установка успешно завершена . Сейчас компьютер будет перезагружен .
▓▓▓▓▓▓█░░░░░░░░░░░░░░█░
▓▓▓▓▓▓█░░░░░░░░░░░░░░█░
▓▓▓▓▓▓█░░░░░░░░░░░░░░█░
▓▓▓▓▓▓█████░░░░░░░░░█░░
██████▀░░░░▀▀██████▀░░░░
  <─────────────────────────────────────────────────────────────────────────────────────────────────────────>


'
sleep 5
arch-chroot /mnt /bin/bash -c "exit"
umount -R /mnt
clear
reboot
